<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSAgency - Workflow Diagram</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .workflow-container {
            padding: 40px;
        }

        .section {
            margin-bottom: 50px;
        }

        .section-title {
            font-size: 1.8em;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
        }

        .architecture-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .component {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
        }

        .component:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: #3498db;
        }

        .component-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .component-icon {
            width: 30px;
            height: 30px;
            margin-right: 10px;
            background: #3498db;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .component-content {
            color: #555;
            line-height: 1.6;
        }

        .flow-diagram {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
        }

        .flow-step {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 20px;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .step-description {
            color: #666;
            font-size: 0.95em;
        }

        .arrow {
            text-align: center;
            font-size: 1.5em;
            color: #3498db;
            margin: 10px 0;
        }

        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .tech-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .tech-item:hover {
            border-color: #3498db;
            transform: scale(1.05);
        }

        .tech-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .tech-role {
            font-size: 0.9em;
            color: #666;
        }

        .agent-system {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .agent-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .agent-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .agent-description {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .highlight {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .highlight-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 10px;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin: 10px 0;
            overflow-x: auto;
        }

        @media (max-width: 768px) {
            .architecture-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .workflow-container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ DSAgency AI Assistant Platform</h1>
            <p>Arquitectura y Workflow del Sistema de An√°lisis de Datos Inteligente</p>
        </div>

        <div class="workflow-container">
            <!-- Mermaid JS -->
            <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
            <script>mermaid.initialize({ startOnLoad: true, securityLevel: 'loose', theme: 'default' });</script>
            <!-- Arquitectura General -->
            <div class="section">
                <h2 class="section-title">üèóÔ∏è Arquitectura del Sistema</h2>
                <div class="architecture-grid">
                    <div class="component">
                        <div class="component-title">
                            <div class="component-icon">üåê</div>
                            Frontend (React)
                        </div>
                        <div class="component-content">
                            <strong>Componentes principales:</strong><br>
                            ‚Ä¢ ChatInterface - Interfaz de chat<br>
                            ‚Ä¢ FileUploader - Carga de archivos<br>
                            ‚Ä¢ ModelSelector - Selecci√≥n de modelos<br>
                            ‚Ä¢ Dashboard - Panel principal<br><br>
                            <strong>Tecnolog√≠as:</strong> React, Ant Design, Vite
                        </div>
                    </div>

                    <div class="component">
                        <div class="component-title">
                            <div class="component-icon">‚öôÔ∏è</div>
                            Backend (FastAPI)
                        </div>
                        <div class="component-content">
                            <strong>Servicios principales:</strong><br>
                            ‚Ä¢ API Routes - Endpoints REST<br>
                            ‚Ä¢ Session Manager - Gesti√≥n de sesiones<br>
                            ‚Ä¢ AI Manager - Coordinaci√≥n de agentes<br>
                            ‚Ä¢ File Processing - Procesamiento de archivos<br><br>
                            <strong>Tecnolog√≠as:</strong> FastAPI, Python, CrewAI
                        </div>
                    </div>

                    <div class="component">
                        <div class="component-title">
                            <div class="component-icon">ü§ñ</div>
                            Sistema de Agentes
                        </div>
                        <div class="component-content">
                            <strong>Agentes especializados:</strong><br>
                            ‚Ä¢ Project Director - Coordinador principal<br>
                            ‚Ä¢ Data Analyst - An√°lisis de datos<br>
                            ‚Ä¢ Web Researcher - B√∫squeda web<br>
                            ‚Ä¢ Visualization Expert - Gr√°ficos<br><br>
                            <strong>Framework:</strong> CrewAI, LangChain
                        </div>
                    </div>

                    <div class="component">
                        <div class="component-title">
                            <div class="component-icon">üîß</div>
                            Infraestructura
                        </div>
                        <div class="component-content">
                            <strong>Componentes:</strong><br>
                            ‚Ä¢ LiteLLM Proxy - Gesti√≥n de modelos<br>
                            ‚Ä¢ Docker Compose - Orquestaci√≥n<br>
                            ‚Ä¢ File Storage - Almacenamiento<br>
                            ‚Ä¢ Session Storage - Memoria de sesiones<br><br>
                            <strong>Tecnolog√≠as:</strong> Docker, LiteLLM, Redis
                        </div>
                    </div>
                </div>
            </div>

            <!-- Flujo de Trabajo -->
            <div class="section">
                <h2 class="section-title">üîÑ Flujo de Trabajo Principal</h2>
                <div class="flow-diagram">
                    <!-- Diagrama de Secuencia (Mermaid) -->
                    <div class="section" style="margin-bottom:20px;">
<div class="mermaid">
sequenceDiagram
    participant U as Usuario
    participant FE as Frontend (React)
    participant BE as Backend (FastAPI)
    participant SM as SessionManager
    participant AIM as AIManager/CrewAI
    participant LLP as LiteLLM Proxy

    U->>FE: Abre app
    FE->>FE: Genera sessionId (UUID)

    U->>FE: Sube archivo (CSV/Excel)
    FE->>BE: POST /api/analytics/upload-dataset (multipart + session_id)
    BE->>BE: Guarda en /app/uploads y analiza con Pandas
    BE->>SM: update_context(session, {file_path, dataset_context, conversation_history:""})
    BE-->>FE: { file_path, columns, shape, preview }

    FE->>BE: GET /api/models/providers (UI ModelSelector)
    BE->>LLP: GET /v1/models (Bearer master_key)
    LLP-->>BE: Lista de modelos (provider/model)
    BE-->>FE: providers

    FE->>BE: GET /api/models/current?session_id=... (modelo por sesi√≥n)
    BE->>SM: get_or_create_session
    BE-->>FE: { provider, model }
    FE->>BE: POST /api/models/configure?session_id=... {provider, model}
    BE->>SM: session["current_model"]=provider/model

    U->>FE: Env√≠a mensaje por chat
    FE->>BE: POST /api/chat { session_id, message }
    BE->>SM: Recupera {file_path, dataset_context, conversation_history, current_model}
    BE->>AIM: run_crew(..., model=current_model)
    AIM->>LLP: ChatOpenAI(model=provider/model)
    AIM->>AIM: Ejecuta agentes/tareas (incluye Modelador Predictivo)
    AIM-->>BE: Respuesta
    BE->>SM: Append conversation_history
    BE-->>FE: { response }
</div>
                    </div>

                    <div class="flow-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <div class="step-title">Inicializaci√≥n del Sistema</div>
                            <div class="step-description">
                                El usuario accede a la aplicaci√≥n web. Se genera un Session ID √∫nico y se inicializa el contexto de la sesi√≥n.
                            </div>
                        </div>
                    </div>

                    <div class="arrow">‚¨áÔ∏è</div>

                    <div class="flow-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <div class="step-title">Carga de Datos</div>
                            <div class="step-description">
                                El usuario sube un archivo CSV a trav√©s del FileUploader. El archivo se guarda en el servidor con un nombre √∫nico y se analiza para extraer metadatos (columnas, dimensiones).
                            </div>
                        </div>
                    </div>

                    <div class="arrow">‚¨áÔ∏è</div>

                    <div class="flow-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <div class="step-title">Interacci√≥n por Chat</div>
                            <div class="step-description">
                                El usuario env√≠a preguntas sobre los datos a trav√©s del ChatInterface. Cada mensaje incluye el Session ID para mantener el contexto.
                            </div>
                        </div>
                    </div>

                    <div class="arrow">‚¨áÔ∏è</div>

                    <div class="flow-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <div class="step-title">Procesamiento por Agentes</div>
                            <div class="step-description">
                                El Project Director recibe la consulta y la delega al agente especializado apropiado (Data Analyst, Web Researcher, o Visualization Expert).
                            </div>
                        </div>
                    </div>

                    <div class="arrow">‚¨áÔ∏è</div>

                    <div class="flow-step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <div class="step-title">Ejecuci√≥n de Tareas</div>
                            <div class="step-description">
                                Los agentes especializados ejecutan sus tareas usando herramientas espec√≠ficas (an√°lisis de datos, b√∫squeda web, generaci√≥n de gr√°ficos).
                            </div>
                        </div>
                    </div>

                    <div class="arrow">‚¨áÔ∏è</div>

                    <div class="flow-step">
                        <div class="step-number">6</div>
                        <div class="step-content">
                            <div class="step-title">Respuesta al Usuario</div>
                            <div class="step-description">
                                Los resultados se procesan y se devuelven al usuario a trav√©s del ChatInterface. El historial de conversaci√≥n se actualiza en la sesi√≥n.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sistema de Agentes -->
            <div class="section">
                <h2 class="section-title">ü§ñ Sistema de Agentes Inteligentes</h2>
                <div class="agent-system">
                    <h3 style="margin-bottom: 20px;">Arquitectura Multi-Agente con CrewAI</h3>
                    <!-- Diagrama de Componentes (Mermaid) -->
                    <div class="mermaid" style="background:white;color:black;padding:10px;border-radius:8px;">
flowchart LR
  subgraph Client
    FE[React Frontend]\nChatInterface / FileUploader / ModelSelector
  end
  subgraph Server
    BE[FastAPI Backend]\nchat_routes / analytics_routes / model_routes
    SM[(SessionManager)]
    AIM[AIManager\nCrewAI]
  end
  subgraph Infra
    LLP[LiteLLM Proxy]
    Models[Model Providers\n(OpenAI, Anthropic,...)]
    Store[/Volumes: /app/uploads/]
  end

  FE -->|Axios /api| BE
  BE --> SM
  BE --> AIM
  BE --> Store
  AIM --> LLP
  LLP --> Models
                    </div>
                    <div class="agent-grid">
                        <div class="agent-card">
                            <div class="agent-title">üéØ Project Director</div>
                            <div class="agent-description">
                                Coordinador principal que analiza las peticiones del usuario y las delega al agente especializado apropiado. Gestiona el flujo de trabajo y asegura respuestas coherentes.
                            </div>
                        </div>

                        <div class="agent-card">
                            <div class="agent-title">üìä Data Analyst</div>
                            <div class="agent-description">
                                Especialista en an√°lisis de datos con Python y Pandas. Escribe y ejecuta c√≥digo para responder preguntas espec√≠ficas sobre los datasets cargados.
                            </div>
                        </div>

                        <div class="agent-card">
                            <div class="agent-title">üîç Web Researcher</div>
                            <div class="agent-description">
                                Investigador web que busca informaci√≥n espec√≠fica y verificable en internet. Proporciona datos complementarios para enriquecer el an√°lisis.
                            </div>
                        </div>

                        <div class="agent-card">
                            <div class="agent-title">üìà Visualization Expert</div>
                            <div class="agent-description">
                                Experto en visualizaci√≥n de datos que crea gr√°ficos y visualizaciones usando Plotly. Genera representaciones visuales claras de los an√°lisis.
                            </div>
                        </div>
                        <div class="agent-card">
                            <div class="agent-title">ü§ñ Modelador Predictivo</div>
                            <div class="agent-description">
                                Entrena modelos (con `ModelTrainingTool`) y realiza predicciones (con `ModelPredictionTool`).
                                Usa `file_path` y, para predicci√≥n, `model_path` desde el contexto.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tecnolog√≠as -->
            <div class="section">
                <h2 class="section-title">üõ†Ô∏è Stack Tecnol√≥gico</h2>
                <div class="tech-stack">
                    <div class="tech-item">
                        <div class="tech-name">React</div>
                        <div class="tech-role">Frontend Framework</div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-name">FastAPI</div>
                        <div class="tech-role">Backend API</div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-name">CrewAI</div>
                        <div class="tech-role">Multi-Agent Framework</div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-name">LangChain</div>
                        <div class="tech-role">LLM Integration</div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-name">LiteLLM</div>
                        <div class="tech-role">Model Proxy</div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-name">Docker</div>
                        <div class="tech-role">Containerization</div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-name">Pandas</div>
                        <div class="tech-role">Data Processing</div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-name">Plotly</div>
                        <div class="tech-role">Data Visualization</div>
                    </div>
                </div>
            </div>

            <!-- Caracter√≠sticas Destacadas -->
            <div class="section">
                <h2 class="section-title">‚≠ê Caracter√≠sticas Destacadas</h2>
                
                <div class="highlight">
                    <div class="highlight-title">üéØ Gesti√≥n Inteligente de Sesiones</div>
                    <p>Cada usuario recibe un Session ID √∫nico que mantiene el contexto completo de la conversaci√≥n, incluyendo el historial de chat y la informaci√≥n del dataset cargado.</p>
                </div>

                <div class="highlight">
                    <div class="highlight-title">ü§ñ Delegaci√≥n Autom√°tica de Tareas</div>
                    <p>El Project Director analiza autom√°ticamente cada consulta y la delega al agente especializado m√°s apropiado, optimizando el flujo de trabajo.</p>
                </div>

                <div class="highlight">
                    <div class="highlight-title">üíª Ejecuci√≥n Segura de C√≥digo</div>
                    <p>Sistema de herramientas especializadas que permiten la ejecuci√≥n segura de c√≥digo Python para an√°lisis de datos y generaci√≥n de visualizaciones.</p>
                </div>

                <div class="highlight">
                    <div class="highlight-title">üîó Integraci√≥n Multi-Modelo</div>
                    <p>LiteLLM Proxy permite el uso de m√∫ltiples proveedores de modelos de IA (OpenAI, Anthropic, etc.) de forma transparente.</p>
                </div>

                <div class="highlight">
                    <div class="highlight-title">üìä An√°lisis de Datos en Tiempo Real</div>
                    <p>Capacidad de cargar archivos CSV y realizar an√°lisis interactivos con respuestas inmediatas y visualizaciones din√°micas.</p>
                </div>
            </div>

            <!-- Estructura de Archivos -->
            <div class="section">
                <h2 class="section-title">üìÅ Estructura del Proyecto</h2>
                <div class="code-block">
backend/
‚îú‚îÄ‚îÄ agents/           # Sistema de agentes CrewAI
‚îú‚îÄ‚îÄ api/             # Endpoints de FastAPI
‚îú‚îÄ‚îÄ managers/        # Gestores globales
‚îú‚îÄ‚îÄ tools/           # Herramientas de los agentes
‚îú‚îÄ‚îÄ utils/           # Utilidades y helpers
‚îî‚îÄ‚îÄ main.py          # Punto de entrada

frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/  # Componentes React
‚îÇ   ‚îú‚îÄ‚îÄ pages/       # P√°ginas de la aplicaci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ services/    # Servicios de API
‚îî‚îÄ‚îÄ package.json

docker-compose.yml   # Orquestaci√≥n de servicios
                </div>
            </div>
        </div>
    </div>
</body>
</html>
